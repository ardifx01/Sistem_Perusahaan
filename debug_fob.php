<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\nrequire_once __DIR__ . '/bootstrap/app.php';\n\nuse App\\Models\\User;\nuse App\\Models\\DataPencatatan;\nuse Carbon\\Carbon;\n\n// Ambil semua FOB customers\n$fobCustomers = User::where('role', 'fob')->get();\n\necho \"===== DEBUG FOB DATA GHAIB =====\\n\\n\";\n\nforeach ($fobCustomers as $customer) {\n    echo \"FOB: {$customer->name} (ID: {$customer->id})\\n\";\n    echo str_repeat('-', 50) . \"\\n\";\n    \n    // Ambil semua data pencatatan untuk bulan ini\n    $currentMonth = date('Y-m');\n    $startDate = Carbon::now()->startOfMonth();\n    $endDate = Carbon::now()->endOfMonth();\n    \n    $allRecords = $customer->dataPencatatan()->get();\n    echo \"Total Records: \" . $allRecords->count() . \"\\n\";\n    \n    // Filter untuk bulan ini\n    $thisMonthRecords = $allRecords->filter(function($item) use ($startDate, $endDate) {\n        $dataInput = json_decode($item->data_input, true) ?? [];\n        if (!empty($dataInput['waktu'])) {\n            $recordDate = Carbon::parse($dataInput['waktu']);\n            return $recordDate->between($startDate, $endDate);\n        }\n        return false;\n    });\n    \n    echo \"Records Bulan Ini: \" . $thisMonthRecords->count() . \"\\n\";\n    \n    // Hitung total dari controller method vs manual\n    $manualTotal = 0;\n    $hargaFinalTotal = 0;\n    \n    foreach ($thisMonthRecords as $record) {\n        $dataInput = json_decode($record->data_input, true) ?? [];\n        $volume = floatval($dataInput['volume_sm3'] ?? 0);\n        $harga = floatval($customer->harga_per_meter_kubik ?? 0);\n        $calculated = $volume * $harga;\n        \n        $manualTotal += $calculated;\n        $hargaFinalTotal += floatval($record->harga_final ?? 0);\n        \n        if (abs($calculated - $record->harga_final) > 0.01) {\n            echo \"  INCONSISTENT: Record {$record->id} - Calculated: {$calculated}, DB: {$record->harga_final}\\n\";\n        }\n    }\n    \n    echo \"Manual Total: Rp \" . number_format($manualTotal, 2) . \"\\n\";\n    echo \"Harga Final Total: Rp \" . number_format($hargaFinalTotal, 2) . \"\\n\";\n    echo \"Customer Total Purchases: Rp \" . number_format($customer->total_purchases, 2) . \"\\n\";\n    \n    if (abs($manualTotal - $hargaFinalTotal) > 0.01) {\n        echo \"⚠️  PROBLEM: Manual vs DB difference: Rp \" . number_format($manualTotal - $hargaFinalTotal, 2) . \"\\n\";\n    }\n    \n    echo \"\\n\";\n}\n\necho \"===== END DEBUG =====\\n\";\n